# Content Loader Controller

This controller allows you to asynchronously load HTML from an url.

## Installation

```bash
$ yarn add stimulus-components
```

And use it in your JS file:
```js
import { Application } from "stimulus"
import { ContentLoader } from "stimulus-components"

const application = Application.start()
application.register("content-loader", ContentLoader)
```

## Usage

In your controller:
```ruby
class PostsController < ApplicationController
  def comments
    render partial: 'posts/comments', locals: { comments: @post.comments }
  end
end
```

In your routes:
```ruby
Rails.application.routes.draw do
ressources
  get :comments, to: 'posts#comments'
end
```

In your view:
```html
<div
  data-controller="content-loader"
  data-content-loader-url="<%= comments_path %>"
>
  <i class="fas fa-spinner fa-spin"></i> Loading comments...

  This content will be replaced by the content of the `posts/comments` partial generated by Rails.
</div>

<div
  data-controller="content-loader"
  data-content-loader-url="<%= comments_path %>"
  data-content-loader-refresh-interval="5000"
>
  This content will be reloaded every 5 seconds.
</div>

<div
  data-controller="content-loader"
  data-content-loader-url="/message.html"
>
  This content will be replaced by the content of the `/message.html` page in your public folder.
</div>

<div
  data-controller="content-loader"
  data-content-loader-url="/message.html"
  data-content-loader-lazy-loading=""
>
  This content will be replaced only when the element become visible thanks to Intersection Observers.
</div>

<div
  data-controller="content-loader"
  data-content-loader-url="/message.html"
  data-content-loader-lazy-loading=""
  data-content-loader-lazy-loading-root-margin="30px"
  data-content-loader-lazy-loading-threshold="0.4"
>
  You can customize the Intersection Observer options.
</div>

<div
  data-controller="content-loader"
  data-content-loader-url="/message.html"
  data-content-loader-lazy-loading=""
  data-content-loader-refresh-interval="5000"
>
  You can combine lazy loading and refresh interval. The timer will start only after the first fetch.
</div>
```

## Configuration

| Attribute | Default | Description | Optional |
| --------- | ------- | ----------- | -------- |
| `data-content-loader-refresh-interval` | `undefined` | Interval in milliseconds to reload content. | ✅ |
| `data-content-loader-lazy-loading` | `undefined` | Fetch content when element is visible. | ✅ |
| `data-content-loader-lazy-loading-root-margin` | `0px` | rootMargin option for Intersection Observer. | ✅ |
| `data-content-loader-lazy-loading-threshold` | `0` | threshold option for Intersection Observer. | ✅ |

## Credits

This controller is inspired by the [official Stimulus example](https://stimulusjs.org/handbook/working-with-external-resources).
